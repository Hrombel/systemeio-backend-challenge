# Symfony REST-приложение для расчета цены продукта и проведения оплаты

Реализовано 2 эндпоинта:
1. POST: для расчёта цены

http://127.0.0.1:8337/calculate-price

Пример JSON тела запроса:
```
### Calculate Price
POST http://127.0.0.1:8337/calculate-price
Accept: application/json
Content-Type: application/json

{
  "product": 1,
  "taxNumber": "DE123456789",
  "couponCode": "P10"
}

RETURN 200

{
  "meta": { "success": true, "message": "null" },
  "data": { "totalPrice": "107.10" }
}

### Execute Purchase
POST http://127.0.0.1:8337/purchase
Accept: application/json
Content-Type: application/json

{
  "product": 1,
  "taxNumber": "IT12345678900",
  "couponCode": "P100",
  "paymentProcessor": "paypal"
}

RETURN 200

{
  "meta": { "success": true, "message": "null" },
  "data": null
}
```

При неверных входных данных или ошибках оплаты возвращается HTTP ответ с кодом 422 или (400), содержащий JSON объект с описанием ошибок.

## Продукты
Продукты хранятся в БД:
- Iphone (100 евро)
- Наушники (20 евро)
- Чехол (10 евро)

## Купоны
Купоны позволяют применить скидку к покупке и могут быть двух типов:
- фиксированная сумма скидки
- процент от суммы покупки

Предполагается, что купоны создаются продавцом и хранятся в системе. Например, при наличии купонов P10 (скидка 10%) и P100 (скидка 100%) покупатель не должен иметь возможности применить несуществующий купон P50.

Формат кода купона задает сам пользователь нашего сервиса.

## Расчет налога
Налог рассчитывается исходя из страны налогового номера и прибавляется к цене продукта:
- Германия - 19%
- Италия - 22%
- Франция - 20%
- Греция - 24%

Например, цена Iphone для покупателя из Греции составит 124 евро (100 евро + налог 24%). Если у покупателя есть купон на 6% скидку, то цена будет 116.56 евро (100 евро - 6% скидка + налог 24%).

## Формат налогового номера
Форматы налоговых номеров для разных стран:
- DEXXXXXXXXX - Германия
- ITXXXXXXXXXXX - Италия
- GRXXXXXXXXX - Греция
- FRYYXXXXXXXXX - Франция

где X - любая цифра от 0 до 9, Y - любая буква. Длина налогового номера различается в зависимости от страны.

## Запуск
Для установки выполните `make init`, что создаст БД с данными, установит зависимости и запустит Symfony-приложение на порту 8337, смонтировав текущую директорию в контейнер.

Имейте в виду: контейнер предназначен для Linux и Mac. Для Windows потребуется WSL.

## Детали выполнения
При выполнении задания выполнено:
- валидация всех полей запроса, включая корректность налогового номера, используя Symfony Validator
- рассчитывается итоговая цена с учетом купона (если применим) и налога
- использованы `PaypalPaymentProcessor::pay()` или `StripePaymentProcessor::processPayment()` для проведения платежа. Эти классы представлены в компоненте `systemeio/test-for-candidates`.
- обновлен `requests.http`, демонстрируя логику работы приложения.

CRUD для сущностей предполагается уже реализованным, дополнительные проверки в сервисах не требуются.

Учтена возможность добавления новых платежных процессоров.

### Также выполнено:
- Контейнеризация БД PostgreSQL
- Использование сущностей, PostgreSQL
- Наличие PHPUnit тестов
- ??  Соответствие кода принципам SOLID
- Поэтапное оформление коммитов
- Задание выполнялось с учетом Best Practices Symfony Framework
